<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>bstring: Better String library Security Statement</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">bstring
   &#160;<span id="projectnumber">0.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Better String library Security Statement </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>by Paul Hsieh</p>
<h2>Introduction</h2>
<p>The Better String library (hereafter referred to as Bstrlib) is an attempt to provide improved string processing functionality to the C and C++ languages. At the heart of the Bstrlib is the management of "bstring"s which are a significant improvement over '\0' terminated char buffers. See the accompanying documenation file bstrlib.txt for more information.</p>
<p>DISCLAIMER: THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
<p>Like any software, there is always a possibility of failure due to a flawed implementation. Nevertheless a good faith effort has been made to minimize such flaws in Bstrlib. Also, use of Bstrlib by itself will not make an application secure or free from implementation failures. However, it is the author's conviction that use of Bstrlib can greatly facilitate the creation of software meeting the highest possible standards of security.</p>
<p>Part of the reason why this document has been created, is for the purpose of security auditing, or the creation of further "Statements on Security" for software that is created that uses Bstrlib. An auditor may check the claims below against Bstrlib, and use this as a basis for analysis of software which uses Bstrlib.</p>
<h2>Statement on Security</h2>
<p>This is a document intended to give consumers of the Better String Library who are interested in security an idea of where the Better String Library stands on various security issues. Any deviation observed in the actual library itself from the descriptions below should be considered an implementation error, not a design flaw.</p>
<p>This statement is not an analytical proof of correctness or an outline of one but rather an assertion similar to a scientific claim or hypothesis. By use, testing and open independent examination (otherwise known as scientific falsifiability), the credibility of the claims made below can rise to the level of an established theory.</p>
<h2>Common Security Issues</h2>
<h3>Buffer Overflows</h3>
<p>The Bstrlib API allows the programmer a way to deal with strings without having to deal with the buffers containing them. Ordinary usage of the Bstrlib API itself makes buffer overflows impossible.</p>
<p>Furthermore, the Bstrlib API has a superset of basic string functionality as compared to the C library's <code>char *</code> functions, C++'s <code>std::string</code> class and Microsoft's MFC based <code>CString</code> class. It also has abstracted mechanisms for dealing with IO. This is important as it gives developers a way of migrating all their code from a functionality point of view.</p>
<h3>Memory Size Overflow/Wrap Around Attack</h3>
<p>Bstrlib is impervious to memory size overflow attacks by design. The reason is it is resiliant to length overflows is that bstring lengths are bounded above by <code>INT_MAX</code>, instead of <code>~(size_t)0</code>. So length addition overflows cause a wrap around of the integer value making them negative causing <code>balloc</code> to fail before an erroneous operation can occurr. Attempted conversions of <code>char *</code> strings which may have lengths greater than <code>INT_MAX</code> are detected and the conversion is aborted.</p>
<p>It is unknown if this property holds on machines that don't represent integers as 2s complement. It is recommended that Bstrlib be carefully auditted by anyone using a system which is not 2s complement based.</p>
<h3>Constant String Protection</h3>
<p>Bstrlib implements runtime enforced constant and read-only string semantics, i.e., bstrings which are declared as constant via the <code>bsStatic</code> macro cannot be modified or deallocated directly through the Bstrlib API, and this cannot be subverted by casting or other type coercion.</p>
<h3>Aliased Bstring Support</h3>
<p>Bstrlib detects and supports aliased parameter management throughout the API. The kind of aliasing that is allowed is the one where pointers of the same basic type may be pointing to overlapping objects (this is the assumption the ANSI C99 specification makes). Each function behaves as if all read-only parameters were copied to temporaries which are used in their stead before the function is enacted (it rarely actually does this). No function in the Bstrlib uses the <code>restrict</code> parameter attribute from the ANSI C99 specification.</p>
<h3>Information leaking</h3>
<p>In <a class="el" href="bstraux_8h.html" title="C example that implements trivial additional functions.">bstraux.h</a>, using the semantically equivalent macros <code>bSecureDestroy</code> and <code>bSecureWriteProtect</code> in place of <code>bdestroy</code> and <code>bwriteprotect</code> respectively will ensure that stale data does not linger in the heap's free space after strings have been released back to memory. Created bstrings are not linked to anything external to themselves, and thus cannot expose deterministic data leaking. If a bstring is resized, the preimage may exist as a copy that is released to the heap. Thus for sensitive data, the bstring should be sufficiently presized before manipulated so that it is not resized. <code>bSecureInput</code> has been supplied in bstraux.c, which can be used to obtain input securely without any risk of leaving any part of the input image in the heap except for the allocated bstring that is returned.</p>
<h3>Memory leaking</h3>
<p>Bstrlib does not do anything out of the ordinary to attempt to deal with the standard problem of memory leaking (losing references to allocated memory) when programming in the C and C++ languages. However, it does not compound the problem any more than exists either, as it doesn't have any intrinsic inescapable leaks in it. Bstrlib does not preclude the use of automatic garbage collection mechanisms such as the Boehm garbage collector.</p>
<h3>Encryption</h3>
<p>Bstrlib does not present any built-in encryption mechanism. However, it supports full binary contents in its data buffers, so any standard block based encryption mechanism can make direct use of bstrings for buffer management.</p>
<h3>Double freeing</h3>
<p>Freeing a pointer that is already free is an extremely rare, but nevertheless a potentially ruthlessly corrupting operation (its possible to cause Win 98 to reboot, by calling free mulitiple times on already freed data using the WATCOM CRT). Bstrlib invalidates the bstring header data before freeing, so that in many cases a double free will be detected and an error will be reported (though this behaviour is not guaranteed and should not be relied on).</p>
<p>Using <code>bstrFree</code> pervasively (instead of <code>bdestroy</code>) can lead to somewhat improved invalid <code>free</code> avoidance (it is completely safe whenever bstring instances are only stored in unique variables). For example: </p>
<pre class="fragment">struct tagbstring hw = bsStatic("Hello, world");
bstring cpHw = bstrcpy(&amp;hw);

#ifdef NOT_QUITE_AS_SAFE
bdestroy(cpHw); /* Never fail */
bdestroy(cpHw); /* Error sometimes detected at runtime */
bdestroy(&amp;hw);  /* Error detected at run time */
#else
bstrFree(cpHw); /* Never fail */
bstrFree(cpHw); /* Will do nothing */
bstrFree(&amp;hw);  /* Will lead to a compile time error */
#endif
</pre><h3>Resource Based Denial of Service</h3>
<p><code>bSecureInput</code> has been supplied in bstraux.c. It has an optional upper limit for input length. But unlike <code>fgets</code>, it is also easily determined if the buffer has been truncated early. In this way, a program can set an upper limit on input sizes while still allowing for implementing context specific truncation semantics, i.e., does the program consume but dump the extra input, or does it consume it in later inputs?</p>
<h3>Mixing <code>char *</code>s and Bstrings</h3>
<p>The bstring and <code>char *</code> representations are not identical. So there is a risk when converting back and forth that data may lost. Essentially bstrings can contain `'\0'<code>as a valid non-terminating character, while</code>char *` strings cannot and in fact must use the character as a terminator. The risk of data loss is very low, since:</p>
<ol type="1">
<li>The simple method of only using bstrings in a <code>char *</code> semantically compatible way is both easy to achieve and pervasively supported.</li>
</ol>
<ol type="1">
<li>Obtaining `'\0'` content in a string is either deliberate or indicative of another, likely more serious problem in the code.</li>
</ol>
<ol type="1">
<li>The library comes with various functions which deal with this issue (namely: <code>bfromcstr</code>, <code>bstr2cstr</code>, and <code>bSetCstrChar</code>)</li>
</ol>
<h2>Marginal Security Issues</h2>
<h3>8-bit Versus 9-bit Portability</h3>
<p>Bstrlib uses <code>CHAR_BIT</code> and other limits.h constants to the maximum extent possible to avoid portability problems. However, Bstrlib has not been tested on any system that does not represent char as 8-bits. So whether or not it works on 9-bit systems is an open question. It is recommended that Bstrlib be carefully auditted by anyone using a system in which <code>CHAR_BIT</code> is not 8.</p>
<h3>EBCDIC/ASCII/UTF-8 Data Representation Attacks</h3>
<p>Bstrlib uses ctype.h functions to ensure that it remains portable to non- ASCII systems. It also checks range to make sure it is well defined even for data that ANSI does not define for the ctype functions.</p>
<h2>Obscure Issues</h2>
<h3>Data attributes</h3>
<p>There is no support for a Perl-like "taint" attribute, however, an example of how to do this using C++'s type system is given as an example. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Mar 9 2013 10:31:59 for bstring by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
