<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>bstring: Better String Library Porting Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">bstring
   &#160;<span id="projectnumber">0.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Better String Library Porting Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>by Paul Hsieh</p>
<p>The bstring library is an attempt to provide improved string processing functionality to the C and C++ language. At the heart of the bstring library is the management of <code>bstring</code>s which are a significant improvement over `'\0'` terminated char buffers. See the accompanying documenation for more information.</p>
<h2>Identifying the Compiler</h2>
<p>Bstrlib has been tested on the following compilers:</p>
<ul>
<li>GNU C/C++</li>
<li>Microsoft Visual C++</li>
<li>Watcom C/C++ (32 bit flat)</li>
<li>Intel's C/C++ compiler (on Windows)</li>
<li>The GNU C/C++ compiler (on Windows/Linux on x86 and PPC64)</li>
<li>Borland C++</li>
<li>Turbo C</li>
</ul>
<p>There are slight differences in these compilers which requires slight differences in the implementation of Bstrlib. These are accomodated in the same sources using <code>#ifdef/#if defined</code> on compiler specific macros. To port Bstrlib to a new compiler not listed above, it is recommended that the same strategy be followed. If you are unaware of the compiler specific identifying preprocessor macro for your compiler you might find it <a href="http://predef.sourceforge.net/precomp.html">here</a>.</p>
<blockquote class="doxtable">
<p>Note: Intel C/C++ on Windows sets the Microsoft identifier: <code>_MSC_VER</code></p>
<p></p>
</blockquote>
<h2>16-bit vs. 32-bit vs. 64-bit Systems</h2>
<p>Bstrlib has been architected to deal with strings of length between <code>0</code> and <code>INT_MAX</code> (inclusive). Since the values of int are never higher than <code>size_t</code> there will be no issue here. Note that on most 64-bit systems <code>int</code> is 32-bit.</p>
<h2>Dependency on The C-Library</h2>
<p>Bstrlib uses the functions <code>memcpy</code>, <code>memmove</code>, <code>malloc</code>, <code>realloc</code>, <code>free</code> and <code>vsnprintf</code>. Many free standing C compiler implementations that have a mode in which the C library is not available will typically not include these functions which will make porting Bstrlib to it onerous. Bstrlib is not designed for such bare bones compiler environments. This usually includes compilers that target ROM environments.</p>
<h2>Porting Issues</h2>
<p>Bstrlib has been written completely in ANSI/ISO C and ISO C++, however, there are still a few porting issues. These are described below.</p>
<h3>Weak C++ Compiler</h3>
<p>C++ is a much more complicated language to implement than C. This has lead to varying quality of compiler implementations. The weaknesses isolated in the initial ports are inclusion of the Standard Template Library, <code>std::iostream</code> and exception handling. By default it is assumed that the C++ compiler supports all of these things correctly. If your compiler does not support one or more of these define the corresponding macro: </p>
<pre class="fragment">BSTRLIB_CANNOT_USE_STL
BSTRLIB_CANNOT_USE_IOSTREAM
BSTRLIB_DOESNT_THROW_EXCEPTIONS
</pre><p>The compiler specific detected macro should be defined at the top of bstrwrap.h in the Configuration defines section. Note that these disabling macros can be overrided with the associated enabling macro if a subsequent version of the compiler gains support. (For example, its possible to rig up STLport to provide STL support for WATCOM C/C++, so <code>-DBSTRLIB_CAN_USE_STL</code> can be passed in as a compiler option.)</p>
<h2>Platform Specific Files</h2>
<p>The makefiles for the examples are basically setup of for particular environments for each platform. In general these makefiles are not portable and should be constructed as necessary from scratch for each platform.</p>
<h2>Testing a port</h2>
<p>To test that a port compiles correctly do the following:</p>
<ol type="1">
<li>Run <code>make check</code> and ensure that no errors are reported.</li>
<li>Run <code>make memcheck</code> and ensure that no errors are reported.</li>
</ol>
<p>The builds must have zero errors and zero warnings. The result of execution should be essentially identical on each platform.</p>
<h2>Performance</h2>
<p>Different CPU and compilers have different capabilities in terms of performance. It is possible for Bstrlib to assume performance characteristics that a platform doesn't have (since it was primarily developed on just one platform). The goal of Bstrlib is to provide very good performance on all platforms regardless of this but without resorting to extreme measures (such as using assembly language, or non-portable intrinsics or library extensions).</p>
<p>There are two performance benchmarks that can be found in the <code>example</code> directory. They are: cbench.c and cppbench.cpp. These are variations and expansions of a benchmark for another string library. They don't cover all string functionality, but do include the most basic functions which will be common in most string manipulation kernels.</p>
<h2>Feedback</h2>
<p>Please send email to the <a href="websnarf@users.sourceforge.net">primary author</a> if you find any issues. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Mar 9 2013 10:31:59 for bstring by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
